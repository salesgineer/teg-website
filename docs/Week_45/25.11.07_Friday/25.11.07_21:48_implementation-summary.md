# Implementation Summary: TEG Next.js Folder Structure

**Quick Reference Guide** - See main planning document for details

---

## Folder Structure at a Glance

```
src/
â”œâ”€â”€ app/[locale]/          # Multi-language routing (lv, en, ru)
â”œâ”€â”€ components/            # Reusable UI and feature components
â”œâ”€â”€ lib/                   # Utilities, hooks, validation, CMS clients
â”œâ”€â”€ styles/                # Global CSS and animations
â””â”€â”€ content/               # Static content (fallback)
```

---

## Three Key Concepts

### 1. Dynamic Locale Routing

Every page exists at `/{locale}/` allowing three language versions:

```
/lv/services/...    (Latvian - Complete)
/en/services/...    (English - 40% complete)
/ru/services/...    (Russian - Limited)
```

### 2. Service-Driven Architecture

Three primary services with dedicated routes:

- **Pre-Purchase Inspection:** `/[locale]/services/pre-purchase-inspection`
- **Car Search & Delivery:** `/[locale]/services/car-search-delivery`
- **Mobile Roadside Service:** `/[locale]/services/roadside-service`

### 3. Sanity CMS + Supabase Integration

- **Sanity:** Content management (pages, services, blog)
- **Supabase:** User data, appointments, form submissions
- **API Routes:** Bridge between frontend and databases

---

## Quick Implementation Checklist

### Phase 1: Foundation (Weeks 1-2)
- [ ] Next.js 15 + TypeScript setup
- [ ] Tailwind CSS configured
- [ ] i18n middleware running
- [ ] Sanity CMS connected
- [ ] Root layout with error boundaries

### Phase 2: Core Pages (Weeks 3-4)
- [ ] Homepage (all 3 locales)
- [ ] Services overview & details
- [ ] About page
- [ ] Contact page (fix English)
- [ ] Navigation/Header/Footer

### Phase 3: Booking System (Weeks 5-6)
- [ ] Appointment form component
- [ ] API endpoints (CRUD)
- [ ] Database schema
- [ ] Email notifications
- [ ] User dashboard

### Phase 4: Content & Language (Weeks 7-8)
- [ ] English translation (40% â†’ 100%)
- [ ] Russian expansion
- [ ] Blog/resources section
- [ ] Testimonials & case studies
- [ ] FAQ section

### Phase 5: Performance & SEO (Weeks 9-10)
- [ ] Image optimization
- [ ] Core Web Vitals tuning
- [ ] Structured data (Schema.org)
- [ ] Sitemap & robots.txt
- [ ] Analytics setup

### Phase 6: Testing & QA (Weeks 11-12)
- [ ] Unit tests
- [ ] Integration tests
- [ ] E2E tests (Playwright)
- [ ] Security audit
- [ ] Cross-browser testing

### Phase 7: Deployment (Week 13)
- [ ] Vercel setup
- [ ] Environment config
- [ ] DNS & domain
- [ ] Production monitoring
- [ ] Launch & monitoring

---

## Critical File Locations

| Purpose | Path |
|---------|------|
| Locale Routing | `src/app/[locale]/` |
| Components | `src/components/` |
| Validation | `src/lib/validations/` |
| Sanity Queries | `src/lib/sanity/queries/` |
| API Routes | `src/app/api/` |
| Hooks | `src/lib/hooks/` |
| Utilities | `src/lib/utils/` |

---

## Environment Variables Needed

```bash
# Sanity
NEXT_PUBLIC_SANITY_PROJECT_ID=
NEXT_PUBLIC_SANITY_DATASET=
SANITY_API_TOKEN=

# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# Email (SendGrid)
SENDGRID_API_KEY=

# Error Tracking (Sentry)
NEXT_PUBLIC_SENTRY_DSN=

# App Config
NEXT_PUBLIC_APP_URL=
NODE_ENV=
```

---

## Technology Stack

**Frontend:**
- Next.js 15.5.4+
- React 19
- TypeScript 5.9+
- TailwindCSS 3.4+
- next-intl (i18n)

**Backend/Services:**
- Sanity CMS
- Supabase (DB + Auth)
- SendGrid (Email)

**Tools:**
- React Hook Form + Zod (validation)
- Framer Motion (animations)
- Sentry (error tracking)
- Google Analytics 4

**Deployment:**
- Vercel (recommended)

---

## Performance Targets

- **LCP:** < 2.5s
- **FID:** < 100ms
- **CLS:** < 0.1
- **FCP:** < 1.8s
- **TTFB:** < 600ms

---

## Language Support Status

| Language | Status | Priority | Action |
|----------|--------|----------|--------|
| Latvian (lv) | Complete 100% | âœ… Done | Maintain |
| English (en) | 40% complete | ðŸ”´ HIGH | Complete Phase 4 |
| Russian (ru) | Limited (2 pages) | ðŸŸ¡ MEDIUM | Expand Phase 4 |

### English Known Issues
- Contact page has placeholder text
- Incomplete service descriptions
- Missing blog content

---

## Key Integration Points

### Sanity to Frontend Flow
```
Sanity CMS Document â†’ GROQ Query â†’ Fetch in Server Component â†’ SSR/ISR â†’ Browser
```

### User Appointment Flow
```
Form Submit â†’ API /appointments â†’ Supabase DB â†’ SendGrid Email â†’ User Email
```

### i18n Flow
```
URL /[locale]/page â†’ Middleware Detection â†’ Layout Props â†’ Component Rendering
```

---

## Code Examples - Quick Reference

### Get Current Locale (Client Component)
```typescript
import { useLocale } from '@/lib/hooks/useLocale';

export function MyComponent() {
  const locale = useLocale(); // Returns 'lv', 'en', or 'ru'
  return <div>{locale}</div>;
}
```

### Fetch Service from Sanity
```typescript
import { getServiceDetails } from '@/lib/sanity/queries/services';

export async function ServicePage({ params }) {
  const service = await getServiceDetails(params.service, params.locale);
  return <ServiceDetail {...service} />;
}
```

### Validate Form Input
```typescript
import { appointmentSchema } from '@/lib/validations/appointment';

const validated = appointmentSchema.parse(formData);
const result = await fetch('/api/appointments', {
  method: 'POST',
  body: JSON.stringify(validated),
});
```

### Link to Another Language
```typescript
import Link from 'next/link';
import { useLocale } from '@/lib/hooks/useLocale';

const locale = useLocale();
const otherLang = locale === 'lv' ? 'en' : 'lv';

<Link href={`/${otherLang}/services`}>Switch Language</Link>
```

---

## Common Patterns

### Data Fetching Pattern
```
Server Component â†’ Sanity/Supabase Fetch â†’ Pass to Client Component as Props
```

### Validation Pattern
```
Client Form Input â†’ Zod Schema Validation â†’ API Route â†’ Supabase â†’ Response
```

### i18n Pattern
```
URL Param [locale] â†’ Middleware Verify â†’ Layout Pass to Children â†’ Components Use Hook
```

### Error Handling Pattern
```
Try/Catch â†’ Log to Sentry â†’ Return User-Friendly Error â†’ UI Displays Message
```

---

## Testing Strategy

- **Unit:** Component rendering, utility functions
- **Integration:** API routes with database
- **E2E:** User workflows (booking, form submission)
- **Performance:** Core Web Vitals, bundle size
- **Security:** OWASP guidelines, CSRF protection

---

## Deployment Checklist

Before going live:
- [ ] All 3 languages complete
- [ ] Core Web Vitals passing
- [ ] No TypeScript errors
- [ ] Tests passing (80%+ coverage)
- [ ] Security audit done
- [ ] SEO metadata complete
- [ ] Email notifications working
- [ ] Analytics configured
- [ ] Error tracking active
- [ ] Backup & recovery plan

---

## Resources

- **Main Document:** `25.11.07_21:47_nextjs-folder-structure-planning.md` (1116 lines)
- **Research Files:** `/obsidian_notes/Projects/TEG/research/`
- **Next.js Docs:** https://nextjs.org/docs
- **Sanity Docs:** https://www.sanity.io/docs
- **Supabase Docs:** https://supabase.com/docs

---

**Last Updated:** 2025-11-07 21:48 (Riga Time)
**Version:** 1.0
