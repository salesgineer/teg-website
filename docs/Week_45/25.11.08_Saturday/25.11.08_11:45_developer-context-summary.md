# TEG Project Developer Context Summary

**Document Version:** 1.1
**Created:** 2025-11-08 11:45 Riga Time
**Last Updated:** 2025-11-08 11:52 Riga Time
**Project:** TEG (Transporta Ekspertu Grupa) - Multi-language Website Redesign
**Phase:** Planning & Initial Development
**Updates:** Added Developer Context section explaining experience level and AI-assisted workflow

---

## TABLE OF CONTENTS

1. [Developer Context](#developer-context)
2. [Project Overview](#project-overview)
3. [Business Context](#business-context)
4. [Technology Stack](#technology-stack)
5. [Project Architecture](#project-architecture)
6. [Code Organization](#code-organization)
7. [Development Workflow & Standards](#development-workflow--standards)
8. [Key Features & Priorities](#key-features--priorities)
9. [Multi-Language Strategy](#multi-language-strategy)
10. [Content & Resources](#content--resources)
11. [Integration Points](#integration-points)
12. [Development Guidelines](#development-guidelines)
13. [Critical Reminders](#critical-reminders)

---

## DEVELOPER CONTEXT (CRITICAL - READ FIRST)

### Experience Level & Background

**IMPORTANT:** The developer working on this project is a **beginner in web development and coding/programming**. This context is critical for LLMs assisting with this project.

#### Current Skill Level
- **Experience:** Limited hands-on development experience
- **Approach:** "Vibe coding" - learning by doing with AI assistance
- **Learning Mode:** Active learning curve, building real projects to learn
- **Technical Knowledge:** Growing understanding, not yet expert-level

#### Development Workflow

The developer leverages **AI-assisted development** for all stages:

1. **Primary Tools:**
   - **Claude Code CLI** (primary development assistant)
   - **Cursor** (secondary, occasional use)
   - Large Language Models as core development partners

2. **LLM Usage Pattern:**
   - **Planning:** LLMs help architect solutions and plan implementation
   - **Research:** LLMs research state-of-the-art best practices
   - **Decision-Making:** Developer evaluates LLM recommendations and chooses best approach
   - **Execution:** LLMs assist with implementation, code generation, debugging
   - **Best Practices:** LLMs guide adherence to industry standards
   - **Learning:** LLMs explain concepts and provide educational context

3. **Research & Decision Process:**
   - Make LLMs research latest best practices and technologies
   - Review community-validated, authoritative sources
   - Understand trade-offs between different approaches
   - Choose solutions based on research and project needs
   - Implement with LLM guidance and support

#### Goals & Quality Standards

**Despite beginner status, the goal remains:**
- Develop **state-of-the-art websites** for clients
- Meet professional quality standards
- Follow industry best practices
- Deliver production-ready, performant, secure applications

**How this is achieved:**
- Heavy reliance on AI assistance at every step
- Thorough research before implementation
- Following established patterns and frameworks
- Leveraging community knowledge and proven solutions
- Continuous learning and improvement

### Implications for LLM Assistants

When working with this developer, LLMs should:

#### ✅ DO:
- **Explain thoroughly:** Provide context and reasoning, not just code
- **Educate while executing:** Explain what you're doing and why
- **Validate assumptions:** Don't assume deep technical knowledge
- **Guide decision-making:** Present options with clear pros/cons
- **Provide best practices:** Explain industry standards and why they matter
- **Use clear examples:** Show concrete examples of concepts
- **Anticipate gaps:** Proactively explain potentially unfamiliar concepts
- **Verify understanding:** Check if explanations are clear
- **Reference authoritative sources:** Link to docs, MDN, official guides
- **Maintain high standards:** Code quality should remain professional despite experience level

#### ❌ DON'T:
- Assume familiarity with advanced concepts without explanation
- Use jargon without defining it
- Skip explaining reasoning behind decisions
- Provide code without context or explanation
- Assume knowledge of debugging techniques
- Skip validation steps or testing guidance
- Rush through complex topics
- Compromise on quality due to experience level

#### Communication Style:
- **Be educational:** Treat each interaction as a learning opportunity
- **Be thorough:** Explain the "why" behind the "what"
- **Be patient:** Complex topics may need breaking down
- **Be supportive:** Encourage learning while maintaining standards
- **Be proactive:** Anticipate questions and explain preemptively
- **Be clear:** Use plain language when possible, define technical terms

#### Code & Implementation:
- **Comment generously:** Explain what code does and why
- **Show alternatives:** Present different approaches with explanations
- **Explain trade-offs:** Help understand implications of decisions
- **Validate safety:** Ensure security and best practices are followed
- **Test thoroughly:** Guide through testing and validation
- **Document clearly:** Create documentation that aids understanding

### Learning Goals

The developer is actively learning:
- Modern web development practices (Next.js, React, TypeScript)
- Backend architecture (Supabase, Sanity CMS, API design)
- Development workflows (git, testing, deployment)
- Performance optimization (Core Web Vitals, lighthouse)
- Security practices (OWASP, CSRF protection, rate limiting)
- Accessibility standards (WCAG 2.1)
- SEO best practices (structured data, meta optimization)

**LLMs should support this learning journey while delivering professional results.**

---

## PROJECT OVERVIEW

### Project Identity

**Client:** TEG (Transporta Ekspertu Grupa)
**Website:** https://www.teg.lv
**Project Name:** teg-website
**Type:** Ground-up website redesign & framework migration
**Current Status:** Research complete, development phase initiated
**Author:** TEG (Transporta Ekspertu Grupa)

### What is TEG?

TEG is an independent automotive inspection and consultation company based in Latvia. They provide expert-level vehicle inspection services across Europe, offering transparency, anti-fraud focus, and professional expertise. Key differentiator: "sava aroda profesionāļu grupa, kam auto ir sirdslieta" (Professional group for whom cars are a passion).

### Critical Urgency Factors

- **Frontity Deprecation:** Current site runs on Frontity framework (discontinued, unmaintained). Major security risk.
- **Legacy Stack Constraints:** Performance limitations and inability to add new features safely.
- **Complete Redesign:** NOT a modification of existing code. This is a ground-up rebuild using modern stack.
- **Multi-language Complexity:** Must support simultaneous content across three languages (Latvian/English/Russian).
- **Business Continuity:** Site handles customer inquiries, appointments, and brand reputation.

### Delivery Expectations

- Professional, production-grade implementation
- SEO-optimized for local search (Latvia) and European reach
- Multi-language support with proper i18n architecture
- Performance-first approach targeting Core Web Vitals
- Security-first design with OWASP guidelines
- WCAG 2.1 AA accessibility compliance

---

## BUSINESS CONTEXT

### Core Services Offered

1. **Pre-Purchase Car Inspection** (€100+)
   - Engine diagnostics, VIN history verification
   - Body & paint condition analysis
   - Detailed photo reports with narrative assessment
   - Coverage: All of Europe
   - Primary value proposition: Independent expert evaluation to prevent fraud

2. **Car Search & Delivery Service** (€350+)
   - Vehicle sourcing and inspection
   - Transportation logistics coordination
   - Documentation preparation assistance
   - Ideal for long-distance purchases or private buyers

3. **Mobile Roadside Service** (€30+)
   - On-site error diagnostics and troubleshooting
   - Battery testing and jump-start service
   - ECU programming capability
   - Lock and window mechanism repair
   - Emergency response service focus

### Brand Positioning

**Key Themes:**
- Independence ("neatkarīgi" - independent experts)
- Anti-fraud crusade (exposing dishonest dealers)
- Convenience (remote/mobile options, no travel required)
- Transparency (clear pricing, detailed reporting)
- Professional expertise (certified automotive specialists)

**Contact Information:**
- Phone: +371 25 201 710
- Operating Hours: Monday-Saturday, 9:00 AM - 8:00 PM
- Social Presence: Instagram @teg.auto, TikTok @teg.auto, Facebook: Transportaekspertugrupa

---

## TECHNOLOGY STACK

### Frontend Framework

- **Framework:** Next.js 16.0.1+ (App Router, Server Components enabled)
- **React Version:** 19.2.0 (with experimental features)
- **TypeScript:** 5.9.3+ (strict mode enabled)
- **Node.js:** >=20 (required)
- **CSS Framework:** TailwindCSS 4.1.16+ with custom PostCSS pipeline
- **UI Components:** Radix UI (accessible component library)
- **Icons:** Lucide React (modern SVG icon library)

### Backend & Services

- **CMS:** Sanity.io (headless CMS for content management)
- **Database:** Supabase (PostgreSQL-based with authentication)
- **Email Service:** SendGrid (transactional email for notifications)
- **Authentication:** Supabase Auth with SSR support (@supabase/ssr)
- **ORM/Query:** Raw SQL via Supabase client (@supabase/supabase-js ^2.45.1)

### Internationalization (i18n)

- **Library:** next-intl (^4.4.0)
- **Supported Locales:** Latvian (lv), English (en), Russian (ru)
- **Routing Strategy:** Locale-based routing (`/lv/`, `/en/`, `/ru/`)
- **Content Validation:** i18n-check for completeness validation

### Form Handling & Validation

- **Form Library:** react-hook-form (^7.66.0)
- **Validation Schema:** Zod (^4.1.12) - runtime type checking
- **Resolver:** @hookform/resolvers for Zod integration
- **Security:** Arcjet (@arcjet/next ^1.0.0-beta.13) for rate limiting & CSRF protection

### Styling & Theme

- **CSS Framework:** Tailwind CSS 4.1.16 with PostCSS 4
- **Class Utility:** clsx (^2.1.1), tailwind-merge (^3.3.1)
- **Theme Management:** next-themes (^0.4.6) for light/dark mode toggle
- **Component Library:** Custom components + Radix UI primitives

### Monitoring & Analytics

- **Error Tracking:** Sentry (@sentry/nextjs ^10.22.0)
- **Analytics:** PostHog (^1.284.0) for product analytics
- **Logging:** LogTape (@logtape/logtape ^1.1.2) - structured logging
- **Monitoring:** Built-in Next.js instrumentation (instrumentation.ts)

### Development Tools

- **Code Linting:** ESLint 9.39+ with @antfu/eslint-config
  - Next.js plugin (@next/eslint-plugin-next)
  - React hooks validation (eslint-plugin-react-hooks)
  - Tailwind CSS linting (eslint-plugin-tailwindcss)
  - Playwright test linting (eslint-plugin-playwright)
- **Type Checking:** TypeScript compiler with strict mode
- **Dependency Auditing:** Knip (^5.66.4) for unused code detection
- **Task Runner:** Justfile (just command runner)
- **Git Hooks:** Lefthook (^2.0.2) for pre-commit/pre-push automation

### Testing Stack

- **Unit/Integration:** Vitest (^4.0.4)
  - Browser testing: @vitest/browser-playwright
  - Coverage: @vitest/coverage-v8
- **E2E Testing:** Playwright (^1.56.1)
- **Test Data:** @faker-js/faker (^10.1.0)
- **Assertion Library:** Chai (via Vitest)

### Build & Deploy

- **Build Tool:** Next.js with Webpack (--webpack flag)
- **Bundle Analysis:** @next/bundle-analyzer
- **Deployment Platform:** Vercel (recommended)
- **Environment Management:** @t3-oss/env-nextjs (^0.13.8) for type-safe env vars
- **Semantic Versioning:** semantic-release (^25.0.1) with conventional commits

### Utilities & Helpers

- **Notifications:** Sonner (^2.0.7) - toast notifications
- **HTTP Requests:** (future) httpie/xh for testing
- **String Case Conversion:** Used in component internals
- **Environment Variables:** dotenv-cli for development

### Build Optimization

- **React Compiler:** babel-plugin-react-compiler (^1.0.0) for auto-optimization
- **Code Splitting:** Automatic via Next.js App Router
- **Image Optimization:** Next.js Image component with Sanity pipeline
- **CSS Optimization:** Tailwind CSS purging in production

---

## PROJECT ARCHITECTURE

### Directory Structure

```
/home/fivefingerdisco/Projects/TEG_001/
├── src/                                 # Main application source code
│   ├── app/                             # Next.js 13+ App Router
│   │   ├── [locale]/                    # Dynamic locale segment (lv|en|ru)
│   │   │   ├── page.tsx                 # Homepage
│   │   │   ├── layout.tsx               # Root layout with locale context
│   │   │   ├── error.tsx                # Error boundary
│   │   │   ├── not-found.tsx            # 404 page
│   │   │   ├── services/                # Services section
│   │   │   ├── about/                   # About/Company information
│   │   │   ├── contact/                 # Contact & inquiry forms
│   │   │   ├── appointments/            # Booking system (future)
│   │   │   └── blog/                    # Blog/content section (future)
│   │   └── api/                         # API routes (backend)
│   │       ├── appointments/            # Appointment management
│   │       ├── contact/                 # Contact form submission
│   │       ├── admin/                   # Admin endpoints
│   │       └── health/                  # Health check endpoint
│   │
│   ├── components/                      # Reusable React components
│   │   ├── ui/                          # Base UI components
│   │   │   ├── button.tsx
│   │   │   ├── input.tsx
│   │   │   ├── textarea.tsx
│   │   │   ├── select.tsx
│   │   │   ├── dialog.tsx
│   │   │   ├── navigation-menu.tsx
│   │   │   ├── dropdown-menu.tsx
│   │   │   ├── alert-dialog.tsx
│   │   │   ├── separator.tsx
│   │   │   ├── label.tsx
│   │   │   └── sonner.tsx               # Toast notifications
│   │   ├── forms/                       # Form-specific components
│   │   │   ├── contact-form.tsx         # Main contact form
│   │   │   ├── appointment-form.tsx     # Booking form
│   │   │   └── inquiry-form.tsx         # Service inquiry
│   │   ├── features/                    # Feature-specific components
│   │   │   ├── header.tsx               # Site header/navigation
│   │   │   ├── footer.tsx               # Site footer
│   │   │   ├── hero-section.tsx         # Homepage hero
│   │   │   ├── service-card.tsx         # Service showcase
│   │   │   └── testimonials.tsx         # Customer testimonials
│   │   └── common/                      # Shared layout components
│   │
│   ├── lib/                             # Utility functions & libraries
│   │   ├── sanity/                      # Sanity CMS integration
│   │   │   ├── client.ts                # Sanity client configuration
│   │   │   ├── queries.ts               # GROQ queries
│   │   │   └── types.ts                 # Sanity schema types
│   │   ├── supabase/                    # Supabase integration
│   │   │   ├── client.ts                # Supabase client (browser)
│   │   │   ├── server.ts                # Supabase client (server)
│   │   │   └── queries.ts               # Database query helpers
│   │   ├── validations/                 # Zod validation schemas
│   │   │   ├── contact.ts               # Contact form schema
│   │   │   ├── appointment.ts           # Appointment schema
│   │   │   └── index.ts                 # Schema exports
│   │   ├── constants.ts                 # App-wide constants
│   │   ├── utils.ts                     # General utility functions
│   │   └── helpers.ts                   # Business logic helpers
│   │
│   ├── i18n/                            # Internationalization config
│   │   ├── routing.ts                   # next-intl routing configuration
│   │   ├── request.ts                   # Locale request handling
│   │   └── config.ts                    # i18n settings
│   │
│   ├── locales/                         # Translation files
│   │   ├── lv.json                      # Latvian translations (complete)
│   │   ├── en.json                      # English translations (40% - incomplete)
│   │   └── ru.json                      # Russian translations (limited)
│   │
│   ├── styles/                          # Global styles
│   │   ├── globals.css                  # Global CSS with Tailwind directives
│   │   └── animations.css               # Custom animation definitions
│   │
│   ├── types/                           # TypeScript type definitions
│   │   ├── api.ts                       # API response types
│   │   ├── database.ts                  # Database schema types
│   │   └── index.ts                     # Exported types
│   │
│   ├── utils/                           # Utility function modules
│   │   ├── formatters.ts                # Date/currency/text formatting
│   │   ├── validators.ts                # Custom validation logic
│   │   ├── api-helpers.ts               # API request utilities
│   │   └── analytics.ts                 # Analytics event tracking
│   │
│   ├── validations/                     # Validation schemas
│   │   ├── contact.ts                   # Contact form validation
│   │   ├── appointment.ts               # Appointment validation
│   │   └── index.ts                     # Schema barrel exports
│   │
│   ├── models/                          # Data models & interfaces
│   │   ├── service.ts
│   │   ├── appointment.ts
│   │   └── contact.ts
│   │
│   ├── templates/                       # Email templates
│   │   ├── contact-confirmation.tsx     # Email confirmation to user
│   │   ├── admin-notification.tsx       # Email to admin
│   │   └── appointment-reminder.tsx     # Reminder templates
│   │
│   ├── libs/                            # Third-party library wrappers
│   │   ├── sentry.ts                    # Sentry setup
│   │   ├── posthog.ts                   # PostHog setup
│   │   └── logtape.ts                   # LogTape setup
│   │
│   ├── middleware.ts                    # Next.js middleware (i18n routing, auth)
│   ├── instrumentation.ts               # Server-side instrumentation
│   ├── instrumentation-client.ts        # Client-side instrumentation
│   └── env.ts                           # Environment variable validation
│
├── public/                              # Static assets
│   ├── images/                          # Image files
│   │   ├── services/
│   │   ├── team/
│   │   └── hero/
│   ├── icons/                           # Icon assets
│   ├── fonts/                           # Custom fonts
│   └── robots.txt                       # SEO robots file
│
├── docs/                                # Documentation
│   ├── Week_45/                         # Weekly documentation
│   ├── architecture/                    # Architecture decision records
│   ├── research/                        # Research findings
│   ├── environment-setup-summary.md     # Setup guide
│   └── README.md                        # Docs index
│
├── agent-os/                            # Agent OS workflow directory
│   ├── specs/                           # Feature specifications
│   ├── product/                         # Product documentation
│   └── standards/                       # Development standards
│
├── .claude/                             # Claude Code config
│   ├── agents/                          # Custom agent definitions
│   ├── commands/                        # Slash command definitions
│   ├── mcp_config.json                  # MCP configuration
│   ├── settings.json                    # Claude Code settings
│   └── skills/                          # Skill definitions
│
├── obsidian_notes/                      # Obsidian vault (symlink, git-excluded)
│   └── Projects/TEG/research/           # Research documentation
│       ├── README.md
│       ├── RESEARCH-SUMMARY.md
│       ├── page-copy/
│       ├── technical-analysis/
│       └── scraped-content/
│
├── .next/                               # Next.js build output (git-ignored)
├── node_modules/                        # Dependencies
├── .env                                 # Environment variables (local)
├── .env.example                         # Environment variables template
├── .env.production                      # Production env config
│
├── Configuration Files:
├── tsconfig.json                        # TypeScript configuration
├── next.config.ts                       # Next.js configuration
├── eslint.config.mjs                    # ESLint configuration (FlatConfig)
├── postcss.config.js                    # PostCSS configuration
├── tailwind.config.js                   # Tailwind CSS configuration
├── components.json                      # Shadcn/ui components config
├── jest.config.js                       # Jest configuration (if used)
├── playwright.config.ts                 # Playwright E2E config
├── vitest.config.ts                     # Vitest configuration
├── knip.config.ts                       # Unused code detection
├── commitlint.config.ts                 # Commit message linting
├── justfile                             # Task runner commands
├── lefthook.yml                         # Git hooks configuration
├── codecov.yml                          # Code coverage config
├── package.json                         # Dependencies & scripts
├── pnpm-workspace.yaml                  # PNPM workspace (if monorepo)
│
├── .gitignore                           # Git ignore rules
├── .github/                             # GitHub workflows & config
│   ├── workflows/                       # CI/CD workflows
│   ├── dependabot.yml                   # Dependency updates
│   └── FUNDING.yml                      # Sponsor information
│
├── CLAUDE.md                            # Development workflow rules
├── HANDOFF.md                           # Project handoff documentation
├── LICENSE                              # License (MIT likely)
└── README.md                            # Project readme
```

### Routing Architecture

**Locale-Based Routing with Dynamic Segments:**

```
https://www.teg.lv/[locale]/[page]

Examples:
- https://www.teg.lv/lv/              → Latvian homepage
- https://www.teg.lv/lv/services/     → Latvian services page
- https://www.teg.lv/en/contact       → English contact page
- https://www.teg.lv/ru/about         → Russian about page
```

**Implementation via Next.js App Router:**
- Dynamic segment: `[locale]` catches route parameter
- Middleware redirects root (/) to default locale
- useTranslations() hook provides locale-aware content
- Each page path supports all three languages simultaneously

### Data Flow Architecture

```
Client Request
    ↓
[Middleware] - i18n routing, locale detection, auth checks
    ↓
[Next.js App Router] - Route matching, layout nesting
    ↓
[Server Components] - Fetch from Sanity/Supabase
    ↓
[useTranslations()] - Apply locale-specific content
    ↓
[Client Components] - Interactive features, forms
    ↓
[Sanity CMS] ← Content, structured data, media
[Supabase] ← User data, appointments, form submissions
    ↓
HTML Response to Browser
```

---

## CODE ORGANIZATION

### Component Organization Pattern

**UI Component Template:**
```typescript
// src/components/ui/button.tsx
import { cva, type VariantProps } from "class-variance-authority";
import * as React from "react";

const buttonVariants = cva(
  // base styles
  // variants
);

interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, ...props }, ref) => (
    <button
      ref={ref}
      className={buttonVariants({ variant, size, className })}
      {...props}
    />
  )
);
Button.displayName = "Button";

export { Button, buttonVariants };
```

**Form Component Pattern:**
```typescript
// src/components/forms/contact-form.tsx
"use client";

import { useTranslations } from "next-intl";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { contactSchema } from "@/lib/validations/contact";
import type { ContactFormData } from "@/types/api";

export function ContactForm() {
  const t = useTranslations("forms.contact");
  const form = useForm<ContactFormData>({
    resolver: zodResolver(contactSchema),
  });

  async function onSubmit(data: ContactFormData) {
    // Submit to /api/contact endpoint
  }

  return (
    <form onSubmit={form.handleSubmit(onSubmit)}>
      {/* Form fields with validation */}
    </form>
  );
}
```

### Service Layer Pattern

**Database Queries (Supabase):**
```typescript
// src/lib/supabase/queries.ts
import { createClient } from "@/lib/supabase/server";

export async function getAppointments(userId: string) {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from("appointments")
    .select("*")
    .eq("user_id", userId);

  if (error) throw new Error(error.message);
  return data;
}
```

**CMS Queries (Sanity):**
```typescript
// src/lib/sanity/queries.ts
import { sanityClient } from "@/lib/sanity/client";

export async function getServicesByLocale(locale: string) {
  const query = `*[_type == "service" && language == $locale]`;
  return sanityClient.fetch(query, { locale });
}
```

### Environment Configuration

**Type-Safe Environment Variables:**
```typescript
// src/env.ts
import { createEnv } from "@t3-oss/env-nextjs";
import { z } from "zod";

export const env = createEnv({
  server: {
    DATABASE_URL: z.string().url(),
    SANITY_PROJECT_ID: z.string(),
    SENDGRID_API_KEY: z.string(),
  },
  client: {
    NEXT_PUBLIC_SUPABASE_URL: z.string().url(),
    NEXT_PUBLIC_POSTHOG_KEY: z.string(),
  },
  runtimeEnv: process.env,
});
```

---

## DEVELOPMENT WORKFLOW & STANDARDS

### Nested Delegation Pattern (MANDATORY)

All operations MUST follow 3-tier hierarchy:

**TIER 1 - MAIN (Strategic):**
- Spawns coordinator subagents ONLY
- Synthesizes results, makes decisions
- ONLY allowed tools: AskUserQuestion, ExitPlanMode, TodoWrite, Sequential-Thinking MCP

**TIER 2 - COORDINATOR SUBAGENTS (Tactical):**
- `research-coordinator`: Analysis, exploration
- `task-planner`: Strategy, planning
- `web-dev-worker`: Implementation
- `text-writer`: Documentation
- `spec-initializer`, `product-planner`, `spec-writer`, `task-list-creator`, `implementer`: Agent-OS workflows

**TIER 3 - EXECUTOR SUB-SUBAGENTS (Operational):**
- `general-purpose`: File operations, MCP commands
- `parallel-bash-executor`: Bash operations
- Execute ALL actual work

### Agent-OS Spec-Driven Workflow

**When to Use:** Complex features, new products, uncertain requirements, multi-phase development.

**Workflow Phases:**

1. **SPECIFICATION** (Gather & Document)
   - spec-initializer: Create spec folder structure
   - product-planner: Document mission, goals, roadmap
   - spec-shaper: Targeted clarification (max 5 questions)
   - spec-writer: Create detailed spec.md
   - spec-verifier: Review and verify

2. **PLANNING** (Convert to Tasks)
   - task-list-creator: Read spec.md, create tasks.md with dependencies

3. **IMPLEMENTATION** (Execute Tasks)
   - implementer: Execute tasks.md with all MCP tools
   - implementation-verifier: Verify end-to-end completion

### Debugging Methodology (Sherlock Holmes Pattern)

1. **GATHER EVIDENCE:** Reproduce issue, isolate symptoms, collect logs/errors
2. **GENERATE HYPOTHESES:** Create 3-5 possible causes
3. **ELIMINATE IMPOSSIBILITIES:** Test systematically - "If X, then we'd see Y"
4. **CORROBORATE ROOT CAUSE:** Verify it explains ALL symptoms
5. **VERIFY BEFORE FIX:** Reproduce, test hypothesis, confirm causation

### Tool Directives (Mandatory Replacements)

**File Operations:**
- `find . -name "*.js"` → `fd -e js`
- `grep -r "pattern"` → `rg "pattern"`
- `ls -la` → `lsd -la`
- `cat file.js` → `bat --paging=never file.js`
- `tree` → `lsd --tree` or `fd . -t f`

**Tasks & Data:**
- `npm run <script>` → `just <script>` (if justfile exists)
- `sed 's/old/new/g'` → `sd 'old' 'new'`
- Manual JSON parsing → `jq '.key.value'`
- Manual YAML parsing → `yq '.key.value' file.yml`

**System & Code:**
- `du -sh` → `dust`
- `top` / `ps aux` → `btm` / `procs`

**Parallel Execution:**
```bash
# Run independent commands in parallel
cmd1 & cmd2 & cmd3 & wait
```

### Git Workflow

**Commit Strategy:** Conventional Commits with semantic-release

```
<type>(<scope>): <subject>

<body>

<footer>

Types: feat, fix, docs, style, refactor, test, chore
Scopes: api, ui, forms, i18n, database, etc.
```

**Examples:**
```
feat(forms): add contact form validation with Zod
fix(i18n): resolve Russian translation missing keys
docs(architecture): update routing documentation
refactor(components): extract button styles to CSS module
test(e2e): add appointment flow tests
```

**Pre-commit Hooks (Lefthook):**
- Lint check via ESLint
- Type check via TypeScript
- Format check via prettier (if configured)

### Testing Standards

**Unit Tests (Vitest):**
- Minimum 80% code coverage target
- Test business logic, utilities, validation schemas
- Use @faker-js/faker for test data generation

**Integration Tests (Vitest):**
- Test component rendering with props
- Test form submission flows
- Mock Supabase/Sanity responses

**E2E Tests (Playwright):**
- Critical user journeys (appointment booking, contact form)
- Multi-locale navigation verification
- Form validation and error handling

**Test Commands:**
```bash
npm run test                 # Run unit tests once
npm run test:e2e            # Run Playwright E2E tests
npm run test -- --watch    # Watch mode for development
```

### Code Quality Standards

**TypeScript:**
- Strict mode enabled (all strict flags ON)
- No implicit any
- No unused locals/parameters
- No unchecked indexed access

**ESLint Rules:**
- @antfu/eslint-config base (opinionated, pragmatic)
- Next.js specific rules enforced
- React hooks best practices
- Tailwind CSS class ordering
- Playwright test expectations

**Format & Style:**
- Consistent indentation (2 spaces)
- Import sorting enforced
- Unused code detection via Knip

### Documentation Standards

**File Placement:**
- `/docs/Week_##/YY.MM.DD_DayOfWeek/YY.MM.DD_HH:MM_description.md`

**Content:**
- Clear hierarchy with proper headers
- Code examples with language identifiers
- Technical accuracy verified
- Consistency in terminology

---

## KEY FEATURES & PRIORITIES

### Phase 1 (High Priority - Weeks 1-4)

- Complete English translation (currently 40% done with placeholder issues)
- Implement secure form handling (Zod validation + CSRF protection)
- SEO infrastructure with JSON-LD structured data for automotive services
- Core Web Vitals optimization:
  - Largest Contentful Paint (LCP): <2.5s
  - First Input Delay (FID): <100ms
  - Cumulative Layout Shift (CLS): <0.1
- Supabase database schema for appointments and contacts
- Sentry error tracking integration
- PostHog analytics implementation

### Phase 2 (Medium Priority - Weeks 5-8)

- Complete Russian language coverage (currently limited to 2 pages)
- Blog/content section for SEO strategy
- Customer appointment dashboard
- Admin panel for managing inquiries and appointments
- Email notification system (SendGrid integration)
- Advanced form validations with multi-step booking flow

### Phase 3 (Low Priority - Weeks 9+)

- Enhanced social media integration (Instagram, TikTok feeds)
- Live chat functionality
- FAQ section with rich media
- Customer testimonials/case studies showcase
- PDF report generation for inspection results
- Mobile app considerations

### Critical Known Issues

1. **English Translation Placeholder Text:** Contact page and other pages have placeholder English text (e.g., "Lorem ipsum") that requires immediate attention for production launch.
2. **Russian Content Gap:** Only 2 pages have Russian translations - needs expansion for completeness.
3. **Baseline Performance:** Current site (Frontity) shows performance degradation - new site must exceed 90/100 Lighthouse scores.

---

## MULTI-LANGUAGE STRATEGY

### Language Status

| Language | Status | Coverage | Quality | Notes |
|----------|--------|----------|---------|-------|
| **Latvian (lv)** | Production-Ready | 100% | 4.8/5 | Primary language, complete |
| **English (en)** | In Progress | ~40% | 2/5 | Has placeholder text, needs completion |
| **Russian (ru)** | Minimal | ~10% | 3/5 | Limited to basic pages only |

### i18n Architecture

**Translation File Structure:**
```json
// src/locales/lv.json
{
  "common": {
    "home": "Sākums",
    "services": "Pakalpojumi",
    "about": "Par mums"
  },
  "forms": {
    "contact": {
      "title": "Saziņa ar mums",
      "submit": "Sūtīt"
    }
  }
}
```

**Component Usage:**
```typescript
import { useTranslations } from "next-intl";

export function Header() {
  const t = useTranslations("common");
  return <nav>{t("home")}</nav>;
}
```

**URL Structure:**
- Default redirect: `/` → `/lv/` (Latvian as default)
- Locale switching: Built-in language selector in header
- SEO headers: `hreflang` tags for all locale variants

### Content Translation Workflow

1. **Source Language:** Latvian (complete & accurate)
2. **Secondary:** English (translate from Latvian with professional review)
3. **Tertiary:** Russian (can be via professional service or community)
4. **Validation:** Use `npm run check:i18n` to verify all keys translated

---

## CONTENT & RESOURCES

### Obsidian Vault Structure

**Location:** `/obsidian_notes/Projects/TEG/research/`
(Symlink to Obsidian Vault, git-excluded)

**Contents:**
- `README.md` - Navigation guide
- `RESEARCH-SUMMARY.md` - Executive summary
- `analysis/current-page-structure.md` - Site hierarchy analysis
- `page-copy/` - Extracted content by language
  - `latvian/` - Complete content extraction
  - `english/` - Partial content (incomplete)
  - `russian/` - Limited content
- `scraped-content/` - Detailed page analysis
- `technical-analysis/comprehensive-tech-stack-analysis.md` - Full tech assessment

### Key Documentation Files

**In Project Root:**
- `CLAUDE.md` - Complete development workflow rules (17KB, highly detailed)
- `HANDOFF.md` - Project handoff and context (26KB)
- `justfile` - Task runner definitions
- `.env.example` - Environment variables template

**In /docs:**
- `environment-setup-summary.md` - Setup and installation guide
- `README.md` - Documentation index
- `architecture/` - Architecture decision records
- `research/` - Research findings and analysis

### Content Translation Tools

**Check Translation Completeness:**
```bash
npm run check:i18n
# Output shows missing keys and locale coverage
```

**Add New Translation Key:**
1. Add to `src/locales/lv.json` (Latvian/source)
2. Add to `src/locales/en.json` (English)
3. Add to `src/locales/ru.json` (Russian)
4. Verify with `npm run check:i18n`

---

## INTEGRATION POINTS

### Sanity CMS Integration

**Purpose:** Content management for services, blog posts, testimonials, team info

**Configuration:**
- Environment variables: `NEXT_PUBLIC_SANITY_PROJECT_ID`, `SANITY_API_TOKEN`
- Client location: `src/lib/sanity/client.ts`
- Query examples: `src/lib/sanity/queries.ts`

**GROQ Query Pattern:**
```groq
*[_type == "service" && language == $locale] {
  _id,
  title,
  description,
  price,
  image { asset -> { url } }
}
```

**Usage in Components:**
```typescript
import { getServicesByLocale } from "@/lib/sanity/queries";

export async function ServicesPage() {
  const services = await getServicesByLocale("lv");
  return <Services data={services} />;
}
```

### Supabase Integration

**Purpose:** User authentication, appointment bookings, contact form submissions

**Database Tables:**
- `users` - User profiles and authentication
- `appointments` - Booking records with status tracking
- `contact_submissions` - Form submissions archive
- `notifications` - Email notification queue

**Configuration:**
- Server client: `src/lib/supabase/server.ts`
- Browser client: `src/lib/supabase/client.ts`
- Row-level security (RLS) enabled for data privacy

**Usage Pattern:**
```typescript
const supabase = await createClient(); // Server
const { data, error } = await supabase
  .from("appointments")
  .insert([{ user_id, service, date }]);
```

### SendGrid Integration

**Purpose:** Transactional email for contact confirmations, appointment reminders

**Configuration:**
- API Key: `SENDGRID_API_KEY` environment variable
- From address: `no-reply@teg.lv` (configured in SendGrid)

**Email Templates:**
- Contact form confirmation to user
- Admin notification of new inquiry
- Appointment reminder (24h before)
- Service completion notification

**Usage:**
```typescript
import sgMail from "@sendgrid/mail";

await sgMail.send({
  to: email,
  from: "no-reply@teg.lv",
  subject: t("email.contact.title"),
  html: renderContactConfirmation(data),
});
```

### Sentry Error Tracking

**Purpose:** Production error monitoring and alerting

**Configuration:**
- DSN: `NEXT_PUBLIC_SENTRY_DSN`
- Environment: `development`, `staging`, `production`
- Release tracking: Semantic versioning via semantic-release

**Setup:**
```typescript
import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  environment: process.env.NODE_ENV,
});
```

### PostHog Analytics

**Purpose:** Product analytics for user behavior tracking

**Configuration:**
- API Key: `NEXT_PUBLIC_POSTHOG_KEY`
- Events tracked: Page views, form submissions, button clicks

**Usage:**
```typescript
import { usePostHog } from "posthog-js/react";

export function ContactForm() {
  const posthog = usePostHog();

  function handleSubmit() {
    posthog.capture("contact_form_submitted", {
      service_type: "inspection",
    });
  }
}
```

### Arcjet Security

**Purpose:** Rate limiting and CSRF protection for API endpoints

**Configuration:**
- API Key: `ARCJET_KEY`
- Rules: Rate limit 100 req/min per IP on form endpoints

**Usage:**
```typescript
import arcjet, { createMiddleware } from "@arcjet/next";

const aj = arcjet({
  key: process.env.ARCJET_KEY,
  rules: [
    rateLimit({
      window: "60s",
      max: 100,
      mode: "CHALLENGE",
    }),
  ],
});

const middleware = createMiddleware(aj);
```

---

## DEVELOPMENT GUIDELINES

### Before Starting Development

1. **Review Documentation:**
   - Read CLAUDE.md (workflow rules - MANDATORY)
   - Review HANDOFF.md for project context
   - Check obsidian_notes/Projects/TEG/research/RESEARCH-SUMMARY.md

2. **Check Translation Status:**
   - English content needs completion (40% done)
   - Russian needs expansion beyond 2 pages
   - Use src/locales/ files as source of truth

3. **Environment Setup:**
   - Copy .env.example to .env.local
   - Configure Supabase URL and keys
   - Configure Sanity project ID and token
   - Set up SendGrid API key
   - Configure Sentry DSN

4. **Verify Architecture:**
   - App Router usage (NOT Pages Router)
   - Server components default, client where needed
   - Locale-based routing via [locale] segment
   - Middleware handles i18n redirects

### Technical Standards

**TypeScript:**
- Use strict mode (enforced via tsconfig.json)
- Define types explicitly, no implicit any
- Use Zod for schema validation
- Leverage discriminated unions for type safety

**React Patterns:**
- Server Components for data fetching (default)
- "use client" for interactivity only
- Custom hooks for logic extraction
- Props drilling acceptable if <3 levels deep

**Styling:**
- Tailwind CSS utilities (no custom CSS unless necessary)
- CVA (class-variance-authority) for component variants
- Dark mode support via next-themes
- Mobile-first responsive design

**Forms:**
- react-hook-form + Zod for validation
- Uncontrolled components (better performance)
- Clear error messages in user language
- Accessible labels and ARIA attributes

**API Routes:**
- Type-safe request/response handling
- Proper HTTP status codes (200, 201, 400, 401, 404, 500)
- Rate limiting via Arcjet
- CORS handling for cross-origin requests

**Database Queries:**
- Use Supabase client methods (select, insert, update, delete)
- Always include error handling
- Implement Row-Level Security (RLS)
- Use parameterized queries (prevent SQL injection)

**Performance:**
- Image optimization: Use Next.js Image component
- Code splitting: Automatic via App Router
- CSS-in-JS: Avoid if possible, prefer Tailwind
- Bundle analysis: `npm run build-stats` to check size

**Security:**
- CSRF protection via Arcjet
- Input validation with Zod
- Output encoding for XSS prevention
- Rate limiting on all forms
- Environment variables for secrets
- HTTPS only in production

**Accessibility:**
- Semantic HTML (nav, main, section, article)
- ARIA labels for interactive elements
- Keyboard navigation support
- Color contrast ratio ≥4.5:1
- Alt text for all images
- Form labels properly associated

### Common Development Tasks

**Add New Translation Key:**
```bash
# 1. Add to all locale files
# src/locales/lv.json, en.json, ru.json
# 2. Verify completeness
npm run check:i18n
```

**Create New Component:**
```bash
# 1. Place in appropriate directory
# src/components/[ui|forms|features]/component-name.tsx
# 2. Use TypeScript + Tailwind
# 3. Export from barrel file if needed
```

**Add API Route:**
```bash
# 1. Create file in src/app/api/[route]/route.ts
# 2. Implement POST/GET with proper error handling
# 3. Add rate limiting via Arcjet
# 4. Test with E2E tests
```

**Update Database Schema:**
```bash
# 1. Create migration in Supabase dashboard
# 2. Update TypeScript types in src/types/database.ts
# 3. Update Zod schemas if validation changes
# 4. Test with fixture data
```

### Running Development Server

```bash
# Start Next.js dev server + Spotlight devtools
npm run dev

# or individual commands
npm run dev:next        # Just Next.js on :3000
npm run dev:spotlight   # Just Spotlight on :7999

# Builds
npm run build           # Production build
npm run build-stats     # With bundle analysis

# Testing & Linting
npm run test            # Vitest unit tests
npm run test:e2e        # Playwright E2E
npm run lint            # ESLint check
npm run lint:fix        # Auto-fix linting issues
npm run check:types     # TypeScript check
npm run check:deps      # Unused code detection
```

---

## CRITICAL REMINDERS

### Workflow Requirements (NON-NEGOTIABLE)

1. **ALWAYS use 3-tier nested delegation:** Main → Coordinator → Executor
2. **NEVER execute directly** from Main agent (only 4 allowed tools)
3. **VERIFY before fixing:** Reproduce issue, generate hypotheses, test systematically
4. **Use correct tool binaries:** `fd`, `rg`, `lsd`, `bat`, `just`, `sd`, `xh`
5. **Parallel execution:** Use `& ... & wait` for independent operations
6. **MCP operations:** MUST go through nested delegation
7. **Context preservation:** 20x efficiency with proper nesting

### Project-Specific Directives

1. **This is a complete redesign:** NOT modifying existing Frontity code. Building from scratch.
2. **Three languages simultaneously:** Latvian primary, English needs completion, Russian needs expansion
3. **Production-grade quality:** Not a prototype - immediate production deployment expected
4. **Performance critical:** Core Web Vitals targets are strict (LCP <2.5s, FID <100ms, CLS <0.1)
5. **Security first:** OWASP guidelines, rate limiting, input validation mandatory
6. **Accessibility required:** WCAG 2.1 AA compliance non-negotiable

### Git & Version Control

- Use conventional commits (feat, fix, docs, refactor, test, chore)
- Never force-push to main branch
- Semantic versioning via semantic-release
- Keep commit messages concise but descriptive

### Environment & Configuration

- NEVER commit .env file (use .env.example as template)
- NEVER commit obsidian_notes/ (git-ignored via .gitignore)
- Use .env.production for production environment variables
- Environment variables must be type-safe (@t3-oss/env-nextjs)

### Code Quality Standards

- TypeScript strict mode enabled (non-negotiable)
- Minimum 80% test coverage target
- ESLint must pass before commit (lefthook enforced)
- No unused variables or imports (knip enforces)
- Accessibility checks in E2E tests

---

## APPENDIX: QUICK REFERENCE

### Environment Variables Template

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Sanity CMS
NEXT_PUBLIC_SANITY_PROJECT_ID=your-project-id
SANITY_API_TOKEN=your-api-token

# Third-party Services
SENDGRID_API_KEY=your-sendgrid-key
NEXT_PUBLIC_SENTRY_DSN=your-sentry-dsn
NEXT_PUBLIC_POSTHOG_KEY=your-posthog-key
ARCJET_KEY=your-arcjet-key

# Analytics
NEXT_PUBLIC_GA_ID=your-google-analytics-id

# App Configuration
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### Useful npm Scripts

```bash
npm run dev              # Development server (Next.js + Spotlight)
npm run build            # Production build
npm run start            # Start production server
npm run lint             # Check code style
npm run lint:fix         # Auto-fix style issues
npm run check:types      # TypeScript validation
npm run check:deps       # Unused code detection
npm run check:i18n       # Translation completeness
npm run test             # Run unit tests
npm run test:e2e         # Run E2E tests
npm run build-stats      # Bundle analysis
npm run clean            # Remove build artifacts
```

### Key File Locations

- **Environment:** `.env`, `.env.example`, `.env.production`
- **Workflows:** `CLAUDE.md` (workflow rules), `HANDOFF.md` (context)
- **Architecture:** `docs/architecture/`, `agent-os/specs/`
- **Research:** `obsidian_notes/Projects/TEG/research/` (symlink)
- **Translation Files:** `src/locales/` (lv.json, en.json, ru.json)
- **Configuration:** `tsconfig.json`, `next.config.ts`, `tailwind.config.ts`

### Contact & Business Info

- **Phone:** +371 25 201 710
- **Hours:** Mon-Sat, 9:00 AM - 8:00 PM
- **Website:** https://www.teg.lv
- **Social:** Instagram @teg.auto, TikTok @teg.auto, Facebook: Transportaekspertugrupa
- **Email:** (From contact form submissions → SendGrid → admin)

---

**Document End**

This summary provides comprehensive context for any LLM engaging with the TEG project. Use this as the foundation for understanding project scope, architecture, workflow requirements, and development standards.

Last Updated: 2025-11-08 11:45 Riga Time
